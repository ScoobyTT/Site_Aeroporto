{% extends "base.html" %}

{% block title %}Minhas Passagens - Passagens Online{% endblock %}

{% block content %}
<div class="container mt-4 fade-in">
    <div class="text-center mb-5">
        <h1 class="display-5 fw-bold">
            <i class="bi bi-ticket-perforated-fill text-primary"></i> Minhas Passagens
        </h1>
        <p class="lead text-muted">Visualize todas as suas passagens compradas</p>
    </div>

    {% if btree_voos|length == 0 %}
        <div class="card card-custom text-center p-5">
            <i class="bi bi-inbox" style="font-size: 4rem; color: #6c757d;"></i>
            <h4 class="mt-3 text-muted">Nenhuma passagem encontrada</h4>
            <p class="text-muted">Você ainda não possui passagens cadastradas.</p>
            <a href="{{ url_for('comprar_pass') }}" class="btn btn-primary btn-custom mt-3 mx-auto" style="max-width: 300px;">
                <i class="bi bi-cart-plus"></i> Comprar Passagem
            </a>
        </div>
    {% else %}
        <div class="row g-4">
            {% for voo in btree_voos %}
            <div class="col-md-6 col-lg-4">
                <div class="card card-custom h-100 border-0 shadow-sm">
                    <!-- Cabeçalho do Card -->
                    <div class="card-header bg-primary text-white text-center py-3">
                        <h5 class="mb-0">
                            <i class="bi bi-airplane-fill"></i> Voo #{{ voo.id }}
                        </h5>
                    </div>

                    <div class="card-body">
                        <!-- Informações do Passageiro -->
                        <div class="mb-3 pb-3 border-bottom">
                            <h6 class="text-muted mb-2">
                                <i class="bi bi-person-badge"></i> Passageiro
                            </h6>
                            <p class="mb-1"><strong>{{ voo.cliente_nome }}</strong></p>
                            <small class="text-muted">
                                <i class="bi bi-card-text"></i> CPF: {{ voo.cliente_cpf }}
                            </small><br>
                            <small class="text-muted">
                                <i class="bi bi-envelope"></i> {{ voo.cliente_email }}
                            </small>
                        </div>

                        <!-- Rota -->
                        <div class="mb-3">
                            <h5 class="text-primary fw-bold text-center mb-2">
                                <i class="bi bi-arrow-right-circle"></i>
                                {{ voo.origem }} → {{ voo.destino }}
                            </h5>
                        </div>

                        <!-- Detalhes do Voo -->
                        <div class="row g-2 mb-3">
                            <div class="col-6">
                                <div class="text-center p-2 bg-light rounded">
                                    <small class="text-muted d-block">
                                        <i class="bi bi-calendar3"></i> Data
                                    </small>
                                    <strong>{{ voo.data }}</strong>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="text-center p-2 bg-light rounded">
                                    <small class="text-muted d-block">
                                        <i class="bi bi-clock"></i> Horário
                                    </small>
                                    <strong>{{ voo.horario }}</strong>
                                </div>
                            </div>
                        </div>

                        <!-- Informações Adicionais -->
                        <div class="row g-2 mb-3">
                            <div class="col-6">
                                <div class="text-center p-2 bg-light rounded">
                                    <small class="text-muted d-block">
                                        <i class="bi bi-airplane"></i> Aeronave
                                    </small>
                                    <strong>{{ voo.tipo_aeronave }}</strong>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="text-center p-2 bg-light rounded">
                                    <small class="text-muted d-block">
                                        <i class="bi bi-chair"></i> Assento
                                    </small>
                                    <strong>{{ voo.assento }}</strong>
                                </div>
                            </div>
                        </div>

                        <!-- Milhagem e Preço -->
                        <div class="row g-2 mb-3">
                            <div class="col-6">
                                <div class="text-center p-2 bg-warning bg-opacity-10 rounded">
                                    <small class="text-muted d-block">
                                        <i class="bi bi-star-fill text-warning"></i> Milhagem
                                    </small>
                                    <strong>{{ voo.milhagem }} milhas</strong>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="text-center p-2 bg-success bg-opacity-10 rounded">
                                    <small class="text-muted d-block">
                                        <i class="bi bi-currency-dollar"></i> Valor
                                    </small>
                                    <strong class="text-success">R$ {{ "%.2f"|format(voo.preco) }}</strong>
                                </div>
                            </div>
                        </div>

                        <!-- Data de Cadastro -->
                        <div class="text-center">
                            <small class="text-muted">
                                <i class="bi bi-calendar-check"></i> Comprado em: {{ voo.data_cadastro }}
                            </small>
                        </div>
                    </div>

                    <!-- Footer do Card -->
                    <div class="card-footer bg-transparent border-top-0">
                        <button class="btn btn-outline-primary btn-custom w-100" onclick="verDetalhes({{ voo.id }})">                            <i class="bi bi-info-circle"></i> Ver Detalhes
                        </button>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Resumo -->
        <div class="card card-custom mt-5 bg-light">
            <div class="card-body text-center">
                <h5 class="mb-3">
                    <i class="bi bi-graph-up"></i> Resumo
                </h5>
                <div class="row">
                    <div class="col-md-4">
                        <div class="p-3">
                            <h3 class="text-primary">{{ btree_voos|length }}</h3>
                            <p class="text-muted mb-0">Passagens Compradas</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="p-3">
                            <h3 class="text-success">
                                {% set total = namespace(valor=0) %}
                                {% for voo in btree_voos %}
                                    {% set total.valor = total.valor + voo.preco %}
                                {% endfor %}
                                R$ {{ "%.2f"|format(total.valor) }}
                            </h3>
                            <p class="text-muted mb-0">Total Gasto</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="p-3">
                            <h3 class="text-warning">
                                {% set milhas = namespace(total=0) %}
                                {% for voo in btree_voos %}
                                    {% set milhas.total = milhas.total + voo.milhagem %}
                                {% endfor %}
                                {{ milhas.total }}
                            </h3>
                            <p class="text-muted mb-0">Milhas Acumuladas</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}

    <!-- Botão de Voltar -->
    <div class="text-center my-5">
        <a href="{{ url_for('homepage') }}" class="btn btn-secondary btn-custom px-5">
            <i class="bi bi-arrow-left"></i> Voltar para Home
        </a>
    </div>
</div>

<script>
function verDetalhes(vooId) {
    alert(`Detalhes do voo #${vooId}\n\nEsta funcionalidade será implementada em breve!`);
    // Aqui você pode adicionar um modal ou redirecionar para uma página de detalhes
}
</script>
{% endblock %}